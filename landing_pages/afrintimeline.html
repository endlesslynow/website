<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Historical Timeline of Afrin</title>
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.21.2/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Your JS Data Files (Using CORRECTED relative paths) -->
    <script src="../afrin_timeline/timelineData.js"></script>
    <script src="../afrin_timeline/timelineColors.js"></script>
    <script src="../afrin_timeline/timelinedata_kurdish.js"></script>
    <script src="../afrin_timeline/timelinedata_arabic.js"></script>

    <!-- Google Fonts & Favicon -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='0.9em' font-size='90'%3EðŸŒ¿%3C/text%3E%3C/svg%3E">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #010409; color: #e6edf3; }
        .glass-header { background-color: rgba(1, 4, 9, 0.7); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border-bottom: 1px solid #30363d; }
        .timeline-spine {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 3px;
            height: 100%;
            background-color: #21262d;
        }
        @media (max-width: 768px) {
            .timeline-spine { left: 20px; }
            .timeline-card { width: calc(100% - 40px); margin-left: 40px; }
            .timeline-card.left { margin-left: 40px; }
            .timeline-year { left: -25px; transform: translateX(0); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- REACT COMPONENTS ---

        const EventModal = ({ event, onClose }) => {
            if (!event) return null;
            const getImagePath = (date, isAfrin) => {
                const availableYears = [-2500, -2400, -2300, -2200, -2100, -2000, -1950, -1850, -1800, -1750, -1700, -1650, -1600, -1550, -1500, -1450, -1400, -1350, -1300, -1250, -1200, -1100, -1050, -1000, -990, -980, -970, -960, -950, -940, -930, -920, -910, -900, -890, -880, -870, -860, -850, -840, -830, -820, -810, -800, -790, -780, -770, -760, -750, -740, -730, -720, -710, -700, -690, -680, -670, -660, -650, -640, -630, -620, -610, -600, -590, -580, -570, -560, -550, -540, -530, -520, -510, -500, -490, -480, -410, -400, -390, -380, -370, -360, -350, -340, -330, -320, -310, -300, -290, -280, -270, -260, -250, -230, -220, -210, -200, -190, -180, -170, -160, -150, -140, -130, -120, -110, -100, -90, -80, -70, -60, -50, -40, -30, -20, -10, 0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 110, 120, 130, 140, 150, 160, 170, 180, 190, 200, 210, 220, 230, 240, 250, 260, 270, 280, 290, 300, 310, 320, 330, 340, 350, 360, 370, 380, 390, 400, 410, 420, 430, 440, 450, 460, 470, 480, 490, 500, 510, 520, 530, 540, 550, 560, 570, 580, 590, 600, 610, 620, 630, 640, 650, 660, 670, 680, 690, 700, 710, 720, 730, 740, 750, 760, 770, 780, 790, 800, 810, 820, 830, 840, 850, 860, 870, 880, 890, 900, 910, 920, 930, 940, 950, 960, 970, 980, 990, 1000, 1010, 1020, 1030, 1040, 1050, 1060, 1070, 1080, 1090, 1100, 1110, 1120, 1130, 1140, 1150, 1160, 1170, 1180, 1190, 1200, 1210, 1220, 1230, 1240, 1250, 1260, 1270, 1280, 1290, 1300, 1310, 1320, 1330, 1340, 1350, 1360, 1370, 1380, 1390, 1400, 1410, 1420, 1430, 1440, 1450, 1460, 1470, 1480, 1490, 1500, 1510, 1520, 1530, 1550, 1560, 1570, 1580, 1590, 1600, 1610, 1620, 1630, 1650, 1660, 1670, 1680, 1690, 1700, 1710, 1720, 1730, 1740, 1750, 1760, 1770, 1780, 1790, 1800, 1810, 1820, 1830, 1840, 1850, 1860, 1870, 1880, 1890, 1900, 1910, 1920, 1930, 1940, 1950, 1960, 1970, 1980, 1990, 2000, 2010, 2020];
                const yearMatch = date.match(/-?\d+/);
                if (!yearMatch) return "https://placehold.co/600x400/1f2937/6b7280?text=Invalid+Date";
                const year = parseInt(yearMatch[0], 10);
                const nearestYear = availableYears.reduce((prev, curr) => (Math.abs(curr - year) < Math.abs(prev - year) ? curr : prev));
                const basePath = `../afrin_timeline/images/`;
                const folder = isAfrin ? 'all_years_afrin' : 'all_years_fullmap';
                const prefix = isAfrin ? 'afrin_full_map' : 'full_map';
                const era = nearestYear < 0 ? 'BCE' : '';
                const yearStr = String(Math.abs(nearestYear)).padStart(4, '0');
                return `${basePath}${folder}/${prefix}_${era}${yearStr}.jpg`;
            };
            return (
                <div className="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-4" onClick={onClose}>
                    <div className="bg-gray-900 border border-gray-700 rounded-lg shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto p-6 relative" onClick={e => e.stopPropagation()}>
                        <button onClick={onClose} className="absolute top-4 right-4 text-gray-400 hover:text-white text-3xl">&times;</button>
                        <h3 className="text-2xl font-bold text-white mb-2">{event.mainEvent}</h3>
                        <p className="text-lg text-blue-400 mb-4">{event.startDate}{event.endDate && ` to ${event.endDate}`}</p>
                        {event.additionalInfo && <p className="text-gray-300 mb-6">{event.additionalInfo}</p>}
                        <div className="grid md:grid-cols-2 gap-4">
                            <img src={getImagePath(event.startDate, false)} alt="Regional Map" className="rounded-md w-full h-auto object-cover bg-gray-800"/>
                            <img src={getImagePath(event.startDate, true)} alt="Afrin Area Map" className="rounded-md w-full h-auto object-cover bg-gray-800"/>
                        </div>
                    </div>
                </div>
            );
        };

        const AppHeader = ({ lang, setLang, onFilterChange, currentFilter, filters }) => (
            <header className="glass-header sticky top-0 z-30 p-4">
                <div className="container mx-auto">
                    <div className="flex flex-col md:flex-row justify-between items-center gap-4">
                        <h1 className="text-2xl font-bold text-white flex items-center gap-3"><span className="text-3xl">ðŸŒ¿</span>Historical Timeline of Afrin</h1>
                        <div className="flex gap-2">
                            <button onClick={() => setLang('english')} className={`px-4 py-2 text-sm font-semibold rounded-md transition ${lang === 'english' ? 'bg-blue-600 text-white' : 'bg-gray-800 hover:bg-gray-700'}`}>English</button>
                            <button onClick={() => setLang('kurdish')} className={`px-4 py-2 text-sm font-semibold rounded-md transition ${lang === 'kurdish' ? 'bg-blue-600 text-white' : 'bg-gray-800 hover:bg-gray-700'}`}>KurdÃ®</button>
                            <button onClick={() => setLang('arabic')} className={`px-4 py-2 text-sm font-semibold rounded-md transition ${lang === 'arabic' ? 'bg-blue-600 text-white' : 'bg-gray-800 hover:bg-gray-700'}`}>Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
                        </div>
                    </div>
                    <div className="flex flex-wrap gap-2 mt-4 justify-center">
                        {Object.entries(filters).map(([key, value]) => (
                            <button key={key} onClick={() => onFilterChange(key)} className={`px-3 py-1.5 text-xs font-semibold rounded-full transition ${currentFilter === key ? 'bg-blue-500 text-white' : 'bg-gray-800 text-gray-400 hover:bg-gray-700'}`}>{value}</button>
                        ))}
                    </div>
                </div>
            </header>
        );
        
        const Timeline = ({ data, onEventClick }) => {
            if (!data || !data.columns) return <div className="text-center p-10 text-xl">Loading data... Please ensure you are running a local server.</div>;

            const allEvents = data.columns
                .flatMap(col => col.events.map(event => ({ ...event, category: col.title, color: col.color })))
                .sort((a,b) => parseInt(a.startDate.match(/-?\d+/)[0]) - parseInt(b.startDate.match(/-?\d+/)[0]));
            
            let lastYear = null;

            return (
                <div className="container mx-auto p-4 relative">
                    <div className="timeline-spine"></div>
                    {allEvents.map((event, index) => {
                        const currentYear = parseInt(event.startDate.match(/-?\d+/)[0]);
                        const showYear = !lastYear || Math.floor(currentYear / 100) !== Math.floor(lastYear / 100);
                        lastYear = currentYear;

                        const sideClass = index % 2 === 0 ? 'left md:pr-8' : 'right md:pl-8 md:text-right';
                        const cardAlignment = index % 2 === 0 ? 'md:mr-auto' : 'md:ml-auto';
                        
                        return (
                            <div key={index} className={`relative my-6 md:my-10`}>
                                {showYear && (
                                    <div className="timeline-year absolute top-1/2 -translate-y-1/2 bg-gray-800 border-2 border-gray-700 rounded-full px-3 py-1 text-sm font-semibold">
                                        {Math.abs(Math.floor(currentYear / 100) * 100)} {currentYear < 0 ? 'BCE' : 'CE'}
                                    </div>
                                )}
                                <div className={`timeline-card w-full md:w-5/12 ${cardAlignment} bg-gray-900 border border-gray-700 rounded-lg p-4 cursor-pointer hover:border-blue-500 transition-colors`} onClick={() => onEventClick(event)}>
                                    <p className="font-bold text-lg text-white">{event.mainEvent}</p>
                                    <p className="text-sm text-gray-400">{event.startDate}{event.endDate && ` to ${event.endDate}`}</p>
                                    <p className="text-xs font-semibold mt-2" style={{ color: event.color }}>{event.category}</p>
                                </div>
                            </div>
                        );
                    })}
                </div>
            );
        };
        
        const App = () => {
            const [lang, setLang] = React.useState('english');
            const [data, setData] = React.useState(null);
            const [filteredData, setFilteredData] = React.useState(null);
            const [selectedEvent, setSelectedEvent] = React.useState(null);
            const [currentFilter, setCurrentFilter] = React.useState('All');
            const [filters, setFilters] = React.useState({});

            React.useEffect(() => {
                let rawData;
                if (lang === 'english' && typeof timelineData !== 'undefined') rawData = timelineData;
                else if (lang === 'kurdish' && typeof timelineDataKurdish !== 'undefined') rawData = timelineDataKurdish;
                else if (lang === 'arabic' && typeof timelineDataArabic !== 'undefined') rawData = timelineDataArabic;
                
                if(rawData && rawData.columns) {
                    const climateColumn = { title: "Climate & Environment", events: [
                        { startDate: "4000 BCE", endDate: "2500 BCE", mainEvent: "Holocene Climatic Optimum Decline", additionalInfo: "Gradual cooling and drying trend after a long warm and wet period, impacting early agricultural societies." },
                        { startDate: "2200 BCE", endDate: "1900 BCE", mainEvent: "4.2 kiloyear aridification event", additionalInfo: "A severe, century-scale drought event across the Middle East, linked to the collapse of the Akkadian Empire and shifts in settlement patterns." },
                        { startDate: "1250 BCE", endDate: "850 BCE", mainEvent: "Late Bronze Age Collapse", additionalInfo: "Period of widespread societal collapse, famine, and migration, partly attributed to increased aridity and climate instability." },
                    ]};
                    const otherColumns = rawData.columns.filter(c => c.title !== "Historical Eras");
                    
                    const colorMapping = {};
                    if(typeof timelineColors !== 'undefined' && timelineColors.columns) {
                        timelineColors.columns.forEach(c => { colorMapping[c.title] = c.color; });
                    }
                    colorMapping["Climate & Environment"] = "#3b82f6";

                    const finalColumns = [...otherColumns, climateColumn].map(c => ({...c, color: colorMapping[c.title] || '#ffffff'}));
                    const fullData = { ...rawData, columns: finalColumns };
                    setData(fullData);

                    const filterOptions = { 'All': 'All' };
                    fullData.columns.forEach(c => { filterOptions[c.title] = c.title; });
                    setFilters(filterOptions);
                }
            }, [lang]);

            React.useEffect(() => {
                if (!data) return;
                if (currentFilter === 'All') {
                    setFilteredData(data);
                } else {
                    setFilteredData({
                        ...data,
                        columns: data.columns.filter(c => c.title === currentFilter)
                    });
                }
            }, [data, currentFilter]);

            return (
                <div>
                    <AppHeader lang={lang} setLang={setLang} onFilterChange={setCurrentFilter} currentFilter={currentFilter} filters={filters} />
                    <main>
                        <Timeline data={filteredData} onEventClick={setSelectedEvent} />
                    </main>
                    {selectedEvent && <EventModal event={selectedEvent} onClose={() => setSelectedEvent(null)} />}
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
